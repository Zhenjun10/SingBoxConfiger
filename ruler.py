import json, re, base64
import Logger
#import requests


class Ruler:
    def __init__(self, rule: str = None):
        self.DirectRules = {
            'version': 1,
            'rules': [
                {
                    'ip_cidr': [],
                    'domain': [],
                    'domain_suffix': [],
                    'domain_keyword': [],
                    'domain_regex': []
                }
            ]
        }
        self.ProxyRules = {
            'version': 1,
            'rules': [
                {
                    'ip_cidr': [],
                    'domain': [],
                    'domain_suffix': [],
                    'domain_keyword': [],
                    'domain_regex': []
                }
            ]
        }
        self.RejectRules = {
            'version': 1,
            'rules': [
                {
                    'ip_cidr': [],
                    'domain': [],
                    'domain_suffix': [],
                    'domain_keyword': [],
                    'domain_regex': []
                }
            ]
        }
        if rule is None:
            rule = 'CustomRules'
        self.CustomRules = json.load(open(rule, 'r', encoding='utf-8'))
        self.logger = Logger.Logger()

    @property
    def direct_rules(self):
        return self.DirectRules['rules'][0]

    @property
    def proxy_rules(self):
        return self.ProxyRules['rules'][0]

    @property
    def reject_rules(self):
        return self.RejectRules['rules'][0]

    def collect_share_rules(self):
        rules = self.CustomRules['share']
        for rule in rules:
            if not rule['enable']:
                continue
            # resp = requests.get(rule['content'])

    def collect_subscribe_rules(self):
        rules = self.CustomRules['subscribe']
        for rule in rules:
            if not rule['enable']:
                continue
            # resp = requests.get(rule['content'])
            resp = 'aHlzdGVyaWEyOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHNnMTIzNC4xNTY3ODYueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPXNnMTIzNC4xNTY3ODYueHl6IyVFNSU4OSVBOSVFNCVCRCU5OSVFNiVCNSU4MSVFOSU4NyU4RiVFRiVCQyU5QTEzMS4xMSUyMEdCDQpoeXN0ZXJpYTI6Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAc2cxMjM0LjE1Njc4Ni54eXo6ODA4MC8/aW5zZWN1cmU9MCZzbmk9c2cxMjM0LjE1Njc4Ni54eXojJUU1JUE1JTk3JUU5JUE0JTkwJUU1JTg4JUIwJUU2JTlDJTlGJUVGJUJDJTlBJUU5JTk1JUJGJUU2JTlDJTlGJUU2JTlDJTg5JUU2JTk1JTg4DQpoeXN0ZXJpYTI6Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAc2cxMjM0LjE1Njc4Ni54eXo6ODA4MC8/aW5zZWN1cmU9MCZzbmk9c2cxMjM0LjE1Njc4Ni54eXojJUU2JThFJUE4JUU4JThEJTkwJUU0JUJEJUJGJUU3JTk0JUE4JUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExJUU3JTlCJUI0JUU4JUJGJTlFJUU2JTg4JTk2JUU4JTgwJTg1JUU2JTk3JUE1JUU2JTlDJUFDJUU3JTlCJUI0JUU4JUJGJTlFJUU4JThBJTgyJUU3JTgyJUI5JUVGJUJDJThDJUU5JTgwJTlGJUU1JUJBJUE2JUU2JTlCJUI0JUU1JUJGJUFCDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHdqcHp6Mi4xNTY3ODYueHl6OjU0OTU3P2FsbG93SW5zZWN1cmU9MCZwZWVyPWhrbWF4MDEuMTU2Nzg2Lnh5eiZzbmk9aGttYXgwMS4xNTY3ODYueHl6JnR5cGU9dGNwIyVFNiU5QyU4MCVFNiU5NiVCMCVFOCU4QSU4MiVFNyU4MiVCOSVFNiU5NCVBRiVFNiU4QyU4MUh5c3RlcmlhMiVFNSU4RCU4RiVFOCVBRSVBRSVFRiVCQyU4QyVFOCVBRiVCNyVFNSU4OCVCMCVFNSVBRSU5OCVFNyVCRCU5MSVFNCVCOCU4QiVFOCVCRCVCRCVFNiU5QyU4MCVFNiU5NiVCMCVFNSVBRSVBMiVFNiU4OCVCNyVFNyVBQiVBRiVFRiVCQyU4OCVFNiU5QyU4MCVFNiU5NiVCMCVFNSVBRSU5OCVFNyVCRCU5MTQuZmVpbmlhb3l1bjAxLmxpZmUlRUYlQkMlODklRTUlQkYlQUINCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0B0d2pwenouMTU2Nzg2Lnh5ejo2MzIyNz9hbGxvd0luc2VjdXJlPTAmcGVlcj1oa21heDAxLjE1Njc4Ni54eXomc25pPWhrbWF4MDEuMTU2Nzg2Lnh5eiZ0eXBlPXRjcCMlRTklOTglQjIlRTUlQTQlQjElRTglODElOTQlRTklQTElQjVodHRwcyUzQSUyRiUyRmdpdGh1Yi5jb20lMkZmZWluaWFveXVuDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMHNnbWF4MDIuMTcwMjAzLnh5ejo4MTE/YWxsb3dJbnNlY3VyZT0wJnBlZXI9MHNnbWF4MDIuMTcwMjAzLnh5eiZzbmk9MHNnbWF4MDIuMTcwMjAzLnh5eiZ0eXBlPXRjcCMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTEyJUU3JTlCJUI0JUU4JUJGJTlFJUU1JUJGJUFCDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMXNnMDAwMS4xNTY3ODYueHl6OjgyNj9hbGxvd0luc2VjdXJlPTAmcGVlcj0xc2cwMDAxLjE1Njc4Ni54eXomc25pPTFzZzAwMDEuMTU2Nzg2Lnh5eiZ0eXBlPXRjcCMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTElN0MwMSU3QyVFNyU5QiVCNCVFOCVCRiU5RSVFNSVCRiVBQg0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQDJzZzAwMmZmMGYyODNkLTI0MzMtYmJiZS00ZDdhLTU5OTkwYjhiOGI3NC4yMzMyMzUueHl6OjgxNj9hbGxvd0luc2VjdXJlPTAmcGVlcj0yc2cwMDJmZjBmMjgzZC0yNDMzLWJiYmUtNGQ3YS01OTk5MGI4YjhiNzQuMjMzMjM1Lnh5eiZzbmk9MnNnMDAyZmYwZjI4M2QtMjQzMy1iYmJlLTRkN2EtNTk5OTBiOGI4Yjc0LjIzMzIzNS54eXomdHlwZT10Y3AjJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExJTdDMDIlRTclOUIlQjQlRTglQkYlOUUyJUU1JUJGJUFCDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMnNnbWF4MDIuMTU2Nzg2Lnh5ejo4MjI/YWxsb3dJbnNlY3VyZT0wJnBlZXI9MnNnbWF4MDIuMTU2Nzg2Lnh5eiZzbmk9MnNnbWF4MDIuMTU2Nzg2Lnh5eiZ0eXBlPXRjcCMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTEwMiVFNyU5QiVCNCVFOCVCRiU5RSVFNSVCRiVBQg0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQDFqcDAwMS4xNTY3ODYueHl6OjgyMD9hbGxvd0luc2VjdXJlPTAmcGVlcj0xanAwMDEuMTU2Nzg2Lnh5eiZzbmk9MWpwMDAxLjE1Njc4Ni54eXomdHlwZT10Y3AjJUU2JTk3JUE1JUU2JTlDJUFDMSVFNyU5QiVCNCVFOCVCRiU5RSVFNSVCRiVBQg0KaHlzdGVyaWEyOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQGh5Zm5qcDAxLjE1Njc4Ni54eXo6ODA4MS8/aW5zZWN1cmU9MCZzbmk9aHlmbmpwMDEuMTU2Nzg2Lnh5eiMlRTYlOTclQTUlRTYlOUMlQUNIMDElRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0Axc2cwMDIuMTU2Nzg2Lnh5ejo4MDgwLz9pbnNlY3VyZT0wJnNuaT0xc2cwMDIuMTU2Nzg2Lnh5eiMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTElN0MwMSVFNyU5QiVCNCVFOCVCRiU5RUh5c3RlcmlhMiVFNSVCRiVBQg0KaHlzdGVyaWEyOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQGh5Zm5zZzAxLjE1Njc4Ni54eXo6ODA4MC8/aW5zZWN1cmU9MCZzbmk9aHlmbnNnMDEuMTU2Nzg2Lnh5eiMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTFIMDElRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTIlRTUlQkYlQUINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0Ayc2cxMTA5MzAzZTg4LWM1OGEtOTRiMS1kMTc3LWYwZGVlNDM2N2VhNS4xNzAyMDMueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPTJzZzExMDkzMDNlODgtYzU4YS05NGIxLWQxNzctZjBkZWU0MzY3ZWE1LjE3MDIwMy54eXojJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExJTdDMDIlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0BzZzAwMzk4MTk1OGE4LTE1ZmItZTNjMC1iNGExLTFmOGNlNjVhNmJhYy4yMzMyMzUueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPXNnMDAzOTgxOTU4YTgtMTVmYi1lM2MwLWI0YTEtMWY4Y2U2NWE2YmFjLjIzMzIzNS54eXojJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExMDMlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0Ayc2dtYXgwOS4xNzA4MDkueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPTJzZ21heDA5LjE3MDgwOS54eXojJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExJTdDMDklN0MlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0AycnUwNGQ3YjE2NDhlLTkzMTItMjAzYy04Nzg0LTQ0MjQ3NWQ0MmYxZi4yMzMyMzUueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPTJydTA0ZDdiMTY0OGUtOTMxMi0yMDNjLTg3ODQtNDQyNDc1ZDQyZjFmLjIzMzIzNS54eXojJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExJTdDMDYlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0BoeWZuanAwMy4xNTY3ODYueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPWh5Zm5qcDAzLjE1Njc4Ni54eXojJUU2JTk3JUE1JUU2JTlDJUFDSDAzJUU3JTlCJUI0JUU4JUJGJTlFSHlzdGVyaWEyDQpoeXN0ZXJpYTI6Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAaHlmbmpwMDQuMTU2Nzg2Lnh5ejo4MDgwLz9pbnNlY3VyZT0wJnNuaT1oeWZuanAwNC4xNTY3ODYueHl6IyVFNiU5NyVBNSVFNiU5QyVBQ0gwNCVFNyU5QiVCNCVFOCVCRiU5RUh5c3RlcmlhMg0KaHlzdGVyaWEyOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQGh5Zm5qcDA2LjE1Njc4Ni54eXo6ODA4MC8/aW5zZWN1cmU9MCZzbmk9aHlmbmpwMDYuMTU2Nzg2Lnh5eiMlRTYlOTclQTUlRTYlOUMlQUNIMDYlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0BoeWZuanAwNy4xNTY3ODYueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPWh5Zm5qcDA3LjE1Njc4Ni54eXojJUU2JTk3JUE1JUU2JTlDJUFDSDA3JUU3JTlCJUI0JUU4JUJGJTlFSHlzdGVyaWEyDQpoeXN0ZXJpYTI6Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMWpwMDAzLjE1Njc4Ni54eXo6ODA4MS8/aW5zZWN1cmU9MCZzbmk9MWpwMDAzLjE1Njc4Ni54eXojJUU2JTk3JUE1JUU2JTlDJUFDSDAyJUU3JTlCJUI0JUU4JUJGJTlFSHlzdGVyaWEyDQpoeXN0ZXJpYTI6Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMWpwMDEuMTU2Nzg2Lnh5ejo4MDgwLz9pbnNlY3VyZT0wJnNuaT0xanAwMS4xNTY3ODYueHl6IyVFNiU5NyVBNSVFNiU5QyVBQ0gwNSVFNyU5QiVCNCVFOCVCRiU5RUh5c3RlcmlhMg0KaHlzdGVyaWEyOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHVrMDExNzEyZmJlYy01MDdiLTk1N2UtZTM5Ni03N2NjNjFhNGQ2ZjYuMTcwMjAzLnh5ejo4MDgwLz9pbnNlY3VyZT0wJnNuaT11azAxMTcxMmZiZWMtNTA3Yi05NTdlLWUzOTYtNzdjYzYxYTRkNmY2LjE3MDIwMy54eXojJUU4JThCJUIxJUU1JTlCJUJEJTdDMDElN0MlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0Awa3IwMi4xNTY3ODYueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPTBrcjAyLjE1Njc4Ni54eXojJUU5JTlGJUE5JUU1JTlCJUJEJTdDMDIlN0MlRTclOUIlQjQlRTglQkYlOUVIeXN0ZXJpYTINCmh5c3RlcmlhMjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0Boa21heDAwMy4yMzMyMzUueHl6OjgwODAvP2luc2VjdXJlPTAmc25pPWhrbWF4MDAzLjIzMzIzNS54eXojJUU5JUE2JTk5JUU2JUI4JUFGSDAzJUU3JTlCJUI0JUU4JUJGJTlFSHlzdGVyaWEyJUU1JTlEJTk3DQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHdqcHp6Mi4xNTY3ODYueHl6OjM3MTA3P2FsbG93SW5zZWN1cmU9MCZwZWVyPWhrbWF4MDEuMTU2Nzg2Lnh5eiZzbmk9aGttYXgwMS4xNTY3ODYueHl6JnR5cGU9dGNwIyVFOSVBNiU5OSVFNiVCOCVBRiU3QzAxJTdDJUU5JTlBJUE3JUU5JTgxJTkzDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMXNnMDUxOWE3NmRiNi0xZTg5LTUxMzktNjUwNS01NjUzOGYwZDBiZjIuMTcwMjAzLnh5ejo4MTc/YWxsb3dJbnNlY3VyZT0wJnBlZXI9MXNnMDUxOWE3NmRiNi0xZTg5LTUxMzktNjUwNS01NjUzOGYwZDBiZjIuMTcwMjAzLnh5eiZzbmk9MXNnMDUxOWE3NmRiNi0xZTg5LTUxMzktNjUwNS01NjUzOGYwZDBiZjIuMTcwMjAzLnh5eiZ0eXBlPXRjcCMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTElN0MwNSVFNyU5QiVCNCVFOCVCRiU5RSVFNSVCRiVBQg0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHR3anB6ejIuMTU2Nzg2Lnh5ejozNTkyOT9hbGxvd0luc2VjdXJlPTAmcGVlcj0wc2dtYXgwMi4xNzAyMDMueHl6JnNuaT0wc2dtYXgwMi4xNzAyMDMueHl6JnR5cGU9dGNwIyVFNiU5NiVCMCVFNSU4QSVBMCVFNSU5RCVBMSU3QzAxJUU5JTlBJUE3JUU5JTgxJTkzJUU1JUJGJUFCDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHcyLjIzMzIzNS54eXo6NzI1P2FsbG93SW5zZWN1cmU9MCZwZWVyPXR3Mi4yMzMyMzUueHl6JnNuaT10dzIuMjMzMjM1Lnh5eiZ0eXBlPXRjcCMlRTUlOEYlQjAlRTYlQjklQkUwMSVFNyU5QiVCNCVFOCVCRiU5RUNoYXRHUFQzDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNANWd6ZHguMjMzMjM1Lnh5ejo3MjU/YWxsb3dJbnNlY3VyZT0wJnBlZXI9NWd6ZHguMjMzMjM1Lnh5eiZzbmk9NWd6ZHguMjMzMjM1Lnh5eiZ0eXBlPXRjcCMlRTUlOEYlQjAlRTYlQjklQkUwMiVFNyU5QiVCNCVFOCVCRiU5RUNoYXRHUFQzDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAMmd6ZHgyMS4xNTY3ODYueHl6OjcwNj9hbGxvd0luc2VjdXJlPTAmcGVlcj0yZ3pkeDIxLjE1Njc4Ni54eXomc25pPTJnemR4MjEuMTU2Nzg2Lnh5eiZ0eXBlPXRjcCMlRTUlOEYlQjAlRTYlQjklQkUlN0MwMSVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQyDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHc1LjE3MDIwMy54eXo6MjIyMj9hbGxvd0luc2VjdXJlPTAmcGVlcj10dzUuMTcwMjAzLnh5eiZzbmk9dHc1LjE3MDIwMy54eXojJUU1JThGJUIwJUU2JUI5JUJFJTdDMDUlRTUlQTUlODglRTklQTMlOUVDaGF0R1BUNA0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQDZnemR4Mi4yMzMyMzUueHl6OjcxMj9hbGxvd0luc2VjdXJlPTAmcGVlcj02Z3pkeDIuMjMzMjM1Lnh5eiZzbmk9Nmd6ZHgyLjIzMzIzNS54eXojJUU1JThGJUIwJUU2JUI5JUJFMDIlRTUlQTUlODglRTklQTMlOUVDaGF0R1BUDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAc2cxMTExLjE1Njc4Ni54eXo6NzAzP2FsbG93SW5zZWN1cmU9MCZwZWVyPXNnMTExMS4xNTY3ODYueHl6JnNuaT1zZzExMTEuMTU2Nzg2Lnh5eiMlRTUlOEYlQjAlRTYlQjklQkUlN0MwNCVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQzDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHc0LjIzMzIzNS54eXo6NjcwP2FsbG93SW5zZWN1cmU9MCZwZWVyPXR3NC4yMzMyMzUueHl6JnNuaT10dzQuMjMzMjM1Lnh5eiMlRTUlOEYlQjAlRTYlQjklQkUlN0MwNSVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQ1DQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHc3LjE3MDIwMy54eXo6ODExP2FsbG93SW5zZWN1cmU9MCZwZWVyPXR3Ny4xNzAyMDMueHl6JnNuaT10dzcuMTcwMjAzLnh5eiZ0eXBlPXRjcCMlRTUlOEYlQjAlRTYlQjklQkUlN0MwMiVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFRDDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHczLjIzMzIzNS54eXo6MTExMjU/YWxsb3dJbnNlY3VyZT0wJnBlZXI9dHczLjIzMzIzNS54eXomc25pPXR3My4yMzMyMzUueHl6IyVFNSU4RiVCMCVFNiVCOSVCRSU3QzAzJUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVEMNCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0B0dzEuMTcwMjAzLnh5ejo2Njc4P2FsbG93SW5zZWN1cmU9MCZwZWVyPXR3MS4xNzAyMDMueHl6JnNuaT10dzEuMTcwMjAzLnh5eiMlRTUlOEYlQjAlRTYlQjklQkUlN0MwMiVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQwDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHc2MC4yMzMyMzUueHl6OjcwMz9hbGxvd0luc2VjdXJlPTAmcGVlcj10dzYwLjIzMzIzNS54eXomc25pPXR3NjAuMjMzMjM1Lnh5eiMlRTUlOEYlQjAlRTYlQjklQkUlN0MwMyVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQxDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHdqcHp6Mi4xNTY3ODYueHl6OjMwNzUyP2FsbG93SW5zZWN1cmU9MCZwZWVyPXVzbWF4MDUuMTcwMjAzLnh5eiZzbmk9dXNtYXgwNS4xNzAyMDMueHl6JnR5cGU9dGNwIyVFNyVCRSU4RSVFNSU5QiVCRCU3QzA1JUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVDANCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0A0c2dtYXgwMi4xNTY3ODYueHl6OjcxOD9hbGxvd0luc2VjdXJlPTAmcGVlcj00c2dtYXgwMi4xNTY3ODYueHl6JnNuaT00c2dtYXgwMi4xNTY3ODYueHl6JnR5cGU9dGNwIyVFNiU5NiVCMCVFNSU4QSVBMCVFNSU5RCVBMSU3QzA0JUU3JTlCJUI0JUU4JUJGJTlFNQ0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHR3anB6ei4xNTY3ODYueHl6OjEzNjA4P2FsbG93SW5zZWN1cmU9MCZwZWVyPTJqcDA0MTYyNTMxYmUtMjlhOS0yNzY0LTg2MjctNTFhNWY0NDM2ZmJkLjIzMzIzNS54eXomc25pPTJqcDA0MTYyNTMxYmUtMjlhOS0yNzY0LTg2MjctNTFhNWY0NDM2ZmJkLjIzMzIzNS54eXomdHlwZT10Y3AjJUU2JTk3JUE1JUU2JTlDJUFDNCVFOSU5QSVBNyVFOSU4MSU5MyVFNSVCRiVBQg0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQGpwbWF4MDEuMTcwODA5Lnh5ejo4MTM/YWxsb3dJbnNlY3VyZT0wJnBlZXI9anBtYXgwMS4xNzA4MDkueHl6JnNuaT1qcG1heDAxLjE3MDgwOS54eXomdHlwZT10Y3AjJUU2JTk3JUE1JUU2JTlDJUFDJTdDMDElN0MlRTclOUIlQjQlRTglQkYlOUUlRTUlQkYlQUINCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0AydXNtYXgwMS4xNzAyMDMueHl6OjcxOT9hbGxvd0luc2VjdXJlPTAmcGVlcj0ydXNtYXgwMS4xNzAyMDMueHl6JnNuaT0ydXNtYXgwMS4xNzAyMDMueHl6JnR5cGU9dGNwIyVFNyVCRSU4RSVFNSU5QiVCRCU3QzAxJTdDJUU3JTlCJUI0JUU4JUJGJTlFDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHdqcHp6Mi4xNTY3ODYueHl6OjQ3ODkyP2FsbG93SW5zZWN1cmU9MCZwZWVyPXNnMDAwMy4xNzAyMDMueHl6JnNuaT1zZzAwMDMuMTcwMjAzLnh5eiZ0eXBlPXRjcCMlRTYlOTYlQjAlRTUlOEElQTAlRTUlOUQlQTEwMSVFNSVBNSU4OCVFOSVBMyU5RUNoYXRHUFQNCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0B0d2pwenouMTU2Nzg2Lnh5ejo1NDkwND9hbGxvd0luc2VjdXJlPTAmcGVlcj1zZzAwMDMuMTcwMjAzLnh5eiZzbmk9c2cwMDAzLjE3MDIwMy54eXomdHlwZT10Y3AjJUU2JTk2JUIwJUU1JThBJUEwJUU1JTlEJUExMDIlRTUlQTUlODglRTklQTMlOUVDaGF0R1BUDQp0cm9qYW46Ly8xMzI5NjAwYy04NDcxLTQ5ZmEtYTliZi1iNTI5NDU5NDg2YmNAdHdqcHp6Mi4xNTY3ODYueHl6OjU1NDI4P2FsbG93SW5zZWN1cmU9MCZwZWVyPWhrbWF4MDQuMTcwMjAzLnh5eiZzbmk9aGttYXgwNC4xNzAyMDMueHl6JnR5cGU9dGNwIyVFOSVBNiU5OSVFNiVCOCVBRjAxJUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVA0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHR3anB6ei4xNTY3ODYueHl6OjUzMDE1P2FsbG93SW5zZWN1cmU9MCZwZWVyPWhrbWF4MDQuMTcwMjAzLnh5eiZzbmk9aGttYXgwNC4xNzAyMDMueHl6JnR5cGU9dGNwIyVFOSVBNiU5OSVFNiVCOCVBRjAyJUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVA0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQDJzZzEzY2IyYjZiNGQtOWIzMi0wMWE4LTc1NzQtMzc2YTE3MWJiODMyLjE3MDIwMy54eXo6ODIwP2FsbG93SW5zZWN1cmU9MCZwZWVyPTJzZzEzY2IyYjZiNGQtOWIzMi0wMWE4LTc1NzQtMzc2YTE3MWJiODMyLjE3MDIwMy54eXomc25pPTJzZzEzY2IyYjZiNGQtOWIzMi0wMWE4LTc1NzQtMzc2YTE3MWJiODMyLjE3MDIwMy54eXomdHlwZT10Y3AjJUU3JTk0JUI1JUU2JThBJUE1JUU3JUJFJUE0aHR0cHMlM0ElMkYlMkZ0Lm1lJTJGZmVpbmlhb3l1bmppY2hhbmcNCnRyb2phbjovLzEzMjk2MDBjLTg0NzEtNDlmYS1hOWJmLWI1Mjk0NTk0ODZiY0B0d2pwenoyLjE1Njc4Ni54eXo6MjAyNjM/YWxsb3dJbnNlY3VyZT0wJnBlZXI9dXNtYXgwMy4xNzAyMDMueHl6JnNuaT11c21heDAzLjE3MDIwMy54eXomdHlwZT10Y3AjJUU3JUJFJThFJUU1JTlCJUJEJTdDMDMlRTUlQTUlODglRTklQTMlOUVDaGF0R1BUMQ0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHR3anB6ei4xNTY3ODYueHl6OjYzNjM5P2FsbG93SW5zZWN1cmU9MCZwZWVyPXVzbWF4MDMuMTcwMjAzLnh5eiZzbmk9dXNtYXgwMy4xNzAyMDMueHl6JnR5cGU9dGNwIyVFNyVCRSU4RSVFNSU5QiVCRCU3QzAzJUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVCVFNSVCRiVBQg0KdHJvamFuOi8vMTMyOTYwMGMtODQ3MS00OWZhLWE5YmYtYjUyOTQ1OTQ4NmJjQHR3anB6ei4xNTY3ODYueHl6OjI4MDMzP2FsbG93SW5zZWN1cmU9MCZwZWVyPXVzbWF4MDUuMTcwMjAzLnh5eiZzbmk9dXNtYXgwNS4xNzAyMDMueHl6JnR5cGU9dGNwIyVFNyVCRSU4RSVFNSU5QiVCRCU3QzA1JUU1JUE1JTg4JUU5JUEzJTlFQ2hhdEdQVCVFNSVCRiVBQg0K'
            text = base64.b64decode(resp).decode()
            urls = re.findall(r'@(.*?):\d+\?', text)
            for url in urls:
                self.direct_rules['domain'].append(url)
                self.logger.info('Add', url, 'to domain of DirectRules')

    def collect_common_rules(self):
        rules = self.CustomRules['common']
        for key, value in rules.items():
            for rule in value:
                if not rule['enable']:
                    continue
                elif rule['type'] == 'direct':
                    self.direct_rules[key].append(rule['content'])
                    self.logger.info('Add', rule['content'], 'to', key, 'of DirectRules')
                elif rule['type'] == 'proxy':
                    self.proxy_rules[key].append(rule['content'])
                    self.logger.info('Add', rule['content'], 'to', key, 'of ProxyRules')
                elif rule['type'] == 'reject':
                    self.reject_rules[key].append(rule['content'])
                    self.logger.info('Add', rule['content'], 'to', key, 'of ProxyRules')

    def print_rules(self):
        print(json.dumps(self.CustomRules['uncommon'], indent=2, ensure_ascii=False))


if __name__ == '__main__':
    ruler = Ruler()
    # ruler.print_rules()
    ruler.collect_subscribe_rules()
